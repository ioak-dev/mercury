(this.webpackJsonpmercury=this.webpackJsonpmercury||[]).push([[0],{124:function(e,t,a){},134:function(e,t,a){},196:function(e,t,a){e.exports=a.p+"static/media/mercury_white.a91588b9.svg"},197:function(e,t,a){e.exports=a.p+"static/media/mercury_black.2991a520.svg"},209:function(e,t,a){e.exports=a(472)},214:function(e,t,a){},219:function(e,t,a){},220:function(e,t,a){},221:function(e,t,a){},233:function(e,t,a){},234:function(e,t,a){},235:function(e,t,a){},253:function(e,t,a){},254:function(e,t,a){},255:function(e,t,a){},261:function(e,t){},263:function(e,t){},296:function(e,t){},297:function(e,t){},363:function(e,t,a){},364:function(e,t,a){},365:function(e,t,a){},45:function(e,t,a){},465:function(e,t,a){},468:function(e,t,a){},469:function(e,t,a){},470:function(e,t,a){},472:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(63),o=a.n(c),s=(a(214),a(88)),i=a(11),l=a(36),u=a(193),m=a(7),d={isAuth:!1,firstname:"",lastname:""},p={theme:"theme_dark",textSize:"textsize_medium",themeColor:"themecolor1"},f={users:[]},h={data:[]},v={items:[],logs:[]},E={data:[]},g=Object(l.c)({authorization:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_AUTH":return console.log("GET_AUTH reducer"),Object(m.a)({},e);case"ADD_AUTH":return console.log("ADD_AUTH reducer"),Object(m.a)({},e,{},t.payload);case"REMOVE_AUTH":return console.log("REMOVE_AUTH reducer"),Object(m.a)({},e,{isAuth:!1,firstname:"",lastname:""});default:return e}},profile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_PROFILE":return console.log("GET_PROFILE reducer"),Object(m.a)({},e);case"SET_PROFILE":return console.log("SET_PROFILE reducer"),Object(m.a)({},e,{},t.payload);default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_USER":return console.log("GET_USER reducer"),Object(m.a)({},e);case"ADD_USER":return console.log("ADD_USER reducer"),Object(m.a)({},e,{},t.payload);case"FETCH_ALL_USERS":return console.log("FETCH_ALL_USERS reducer"),Object(m.a)({},e,{},t.payload);default:return e}},category:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_CATEGORY":return console.log("FETCH_CATEGORY reducer"),Object(m.a)({},e,{},t.payload);default:return e}},request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_REQUEST":return console.log("FETCH_REQUEST reducer"),Object(m.a)({},e,{},t.payload);default:return e}},stage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_STAGE":return console.log("FETCH_STAGE reducer"),Object(m.a)({},e,{},t.payload);default:return e}}}),b=[u.a],y=Object(l.e)(g,{},Object(l.d)(l.a.apply(void 0,b))),N=(a(124),a(219),a(9)),w=a(482),O=a(37),j=a(206),k=a(204),_=a(19),A=a(85),S=a(33),I=a(205),T=a(480),U=a(483),C=(a(220),a(481)),R=a(484),P=new C.a;function x(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2?arguments[2]:void 0;P.next({name:e,signal:t,data:a})}function F(){return P.asObservable()}var M=function(e){return Object(n.useEffect)((function(){x("show-navbar-element")}),[]),r.a.createElement("div",{className:"home full"},"Phoenix WS Test home page")},z=(a(221),a(125)),L=function(e){return Object(n.useEffect)((function(){if(e.location.search){var t=z.parse(e.location.search);e.cookies.set("mercury_".concat(t.space),t.authKey),e.history.push("/".concat(t.space,"/dash"))}}),[]),r.a.createElement(r.a.Fragment,null)},q=(a(233),a(116)),D=(a(234),a(235),function(e){return r.a.createElement("svg",{version:"1.0",id:"Layer_1",x:"0px",y:"0px",viewBox:"0 0 57 56",enableBackground:"new 0 0 57 56",style:e.dimension},r.a.createElement("g",{id:"Chat-Fenster"},r.a.createElement("g",{id:"chat_FAQ_Accordion2-Copy-13",transform:"translate(-1364.000000, -1001.000000)"},r.a.createElement("g",{id:"Send-Message",transform:"translate(397.000000, 1008.000000)"},r.a.createElement("g",{id:"Send-Button",transform:"translate(990.000000, 10.000000)"},r.a.createElement("g",{id:"Send_1_"},r.a.createElement("path",{style:e.style,d:"M16,0.5c-0.1-0.1-0.3-0.1-0.4-0.1L-7,10.8c-0.1,0.1-0.2,0.2-0.2,0.3s0.1,0.3,0.2,0.3l6.4,3.1 c0.1,0.1,0.3,0,0.4,0L6,9.9l-4.9,4.9C1,14.9,1,15,1,15.1l0.5,6.2c0,0.1,0.1,0.3,0.2,0.3h0.1c0.1,0,0.2,0,0.3-0.1l3.4-3.9l4.2,2 c0.1,0,0.2,0,0.3,0s0.2-0.1,0.2-0.2l5.9-18.6C16.1,0.7,16.1,0.6,16,0.5z"})))))))}),H=function(e){return r.a.createElement("svg",{viewBox:"0 0 73 73",style:e.dimension},r.a.createElement("polygon",{fill:"#27AAE1",points:"38.5,-3.8 37.9,-3.8 37.9,-3.8 38.5,-3.8 "}),r.a.createElement("g",null,r.a.createElement("path",{fill:"#149ED9",d:"M27.6,23c2.6-1.8,5.8-2.9,9.3-2.9c3.4,0,6.6,1.1,9.3,2.9l6.3-7.5c-4.3-3.2-9.7-5.2-15.6-5.2 c-5.8,0-11.2,1.9-15.6,5.2L27.6,23z",style:e.accent}),r.a.createElement("rect",{x:"32",y:"37.4",width:"9.8",height:"25.6",style:e.style}),r.a.createElement("circle",{fill:"none",stroke:"#000000",strokeWidth:"9.75",strokeMiterlimit:"10",cx:"36.9",cy:"36.5",r:"30.9",style:Object(m.a)({},e.style,{fill:"none"})}),r.a.createElement("polygon",{fill:"#27AAE1",points:"37.2,-3.9 36.6,-3.9 36.6,-3.9 37.2,-3.9 \t"}),r.a.createElement("circle",{cx:"36.9",cy:"32.8",r:"7.8",style:e.style})))},G=function(e){var t=function(e){var t={},a="";switch(e){case"primary":a="var(--color-primary-1)";break;case"secondary":a="var(--color-secondary-1)";break;case"tertiary":a="var(--color-tertiary-1)";break;case"success":a="var(--color-success)";break;case"failure":a="var(--color-failure)";break;case"warning":a="var(--color-warning)";break;default:a=e||"var(--color-foreground-1)"}return t.fill=a,t.color=a,t.stroke=a,t},a=function(){var t={};return t.fontSize=e.size?e.size:"24px",e.svg&&(t.height=e.size?e.size:"24px",t.width="auto"),t};return r.a.createElement("div",{className:"oak-icon"},e.mat&&r.a.createElement("i",{className:"material-icons",style:Object(m.a)({},t(e.color),{},a())},e.mat),e.fa&&r.a.createElement("i",{className:"fontawesome-icons ".concat(e.fa),style:Object(m.a)({},t(e.color),{},a())},e.mat),e.svg&&"send"===e.svg&&r.a.createElement(D,{style:t(e.color),accent:e.accent&&t(e.accent),dimension:a()}),e.svg&&"ioak"===e.svg&&r.a.createElement(H,{style:t(e.color),accent:e.accent&&t(e.accent),dimension:a()}))},B=function(e){var t=Object(i.d)((function(e){return e.profile}));return r.a.createElement("button",{className:"oak-button ".concat(function(){var a,n=e.theme?e.theme:"";return n+=(null===t||void 0===t?void 0:null===(a=t.theme)||void 0===a?void 0:a.includes("theme_light"))?" light":"",n+=e.variant?" ".concat(e.variant):"",e.children||(n+=" icon"),n+=e.invert?" invert":"",n+=e.small?" small":"",n+=e.align?" align-".concat(e.align):""}()),onClick:e.action},r.a.createElement("div",{className:"button-label-container"},e.icon&&r.a.createElement(G,{mat:e.icon,size:"1.2em"}),e.fa&&r.a.createElement(G,{fa:e.fa,size:"1.2em"}),e.svg&&r.a.createElement(G,{svg:e.svg,size:"1.2em"}),e.children&&e.children))},$=function(){return r.a.createElement("div",{className:"landing"},r.a.createElement("div",{className:"space-bottom-4"},r.a.createElement("h3",null,"Mirror rorriM"),r.a.createElement("p",null,r.a.createElement("em",null,r.a.createElement("b",null,"Queen"))," ","Magic Mirror on the wall, who now is the fairest one of all?"),r.a.createElement("p",null,r.a.createElement("em",null,r.a.createElement("b",null,"Magic Mirror"))," ","Over the seven jewelled hills, beyond the seventh fall, in the cottage of the seven dwarfs, dwells Snow White, fairest one of all."),r.a.createElement("p",null,r.a.createElement("em",null,r.a.createElement("b",null,"Queen"))," ","Snow White lies dead in the forest. The huntsman has brought me proof. [holds up her opened box] Behold, her heart."),r.a.createElement("p",null,r.a.createElement("em",null,r.a.createElement("b",null,"Magic Mirror"))," ","Snow White still lives, the fairest in the land. Tis the heart of a pig you hold in your hand."),r.a.createElement("p",null,r.a.createElement("em",null,r.a.createElement("b",null,"Queen"))," ","[repulsed] The heart of a pig?! Then I've been tricked!")),r.a.createElement("div",{className:"action"},r.a.createElement(q.a,{to:"/tenant",className:"navitem",activeClassName:"active"},r.a.createElement(B,{theme:"primary",variant:"disappear"},"Create Tenant"))))},W=a(67),Y=a.n(W),Q="https://mercury-ws.herokuapp.com/api";function K(e,t,a){return Y.a.get((a||Q)+e,t)}function J(e,t,a,n){return Y.a.post((n||Q)+e,t,a)}var V={API_URL_TENANT:"/tenant",API_URL_TENANT_BANNER:"/tenant/banner",API_URL_TENANT_CREATE:"/tenant/create",API_TENANT_URL:"/tenant/sendURL",API_URL_PRESIGNUP:"/auth/keys",API_URL_RESET:"/auth/reset",API_URL_CODE:"/auth/sendResetCode",API_URL_USER_DETAILS:"/user/details",API_URL_STAGE:"/stage",API_URL_PREDICT:"/model/predict",API_URL_CATEGORY:"/category",API_URL_FAQ:"/faq",API_URL_SR:"/servicerequests",API_URL_USER:"/user",API_URL:"/auth/",API_SIGNIN:"/signin",API_SIGNUP:"/signup",API_KEYS:"/keys",API_JWT:"/signin/jwt"},X=a(50),Z=(a(134),a(253),function(){return r.a.createElement("div",null,r.a.createElement("div",{className:"oak-spinner"},r.a.createElement("div",{className:"spinner-wrapper"},r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null),r.a.createElement("span",null))))}),ee=function(e){var t;return r.a.createElement("div",{className:"message ".concat(e.notification.type)},"running"===e.notification.type&&r.a.createElement("div",{className:"message-icon ".concat("running"===e.notification.type?"running":"")},r.a.createElement("i",{className:"material-icons"},"rotate_right")),"success"===e.notification.type&&r.a.createElement("div",{className:"message-icon"},r.a.createElement("i",{className:"material-icons"},"check_circle_outline")),"warning"===e.notification.type&&r.a.createElement("div",{className:"message-icon"},r.a.createElement("i",{className:"material-icons"},"warning")),"failure"===e.notification.type&&r.a.createElement("div",{className:"message-icon"},r.a.createElement("i",{className:"material-icons"},"error_outline")),r.a.createElement("div",{className:"message-text"},null===(t=e.notification)||void 0===t?void 0:t.message),r.a.createElement("div",{className:"message-action"},r.a.createElement("i",{className:"material-icons",onClick:e.handleRemove},"clear")))},te=function(){var e=Object(n.useState)(!1),t=Object(N.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)([]),s=Object(N.a)(o,2),i=s[0],l=s[1],u=Object(n.useState)({notificationList:[]}),m=Object(N.a)(u,2),d=(m[0],m[1],function(e){l(i.filter((function(t){return t.id!==e.id})))});return Object(n.useEffect)((function(){var e=F().subscribe((function(e){"notification"===e.name&&(e.signal?(d(e.data),function(e){var t=Object(X.a)(i);t.unshift(e),l(t),e.duration?setTimeout((function(){d(e)}),e.duration):e.id||setTimeout((function(){d(e)}),5e3)}(e.data),c(!1)):d(e.data)),"spinner"===e.name&&c(e.signal)}));return function(){return e.unsubscribe()}}),[]),r.a.createElement(r.a.Fragment,null,i&&i.length>0&&r.a.createElement("div",{className:"notification"},i.slice(0,5).reverse().map((function(e){return r.a.createElement("div",{key:e.id||e.message},r.a.createElement(ee,{notification:e,handleRemove:d}))}))),a&&r.a.createElement(Z,{"data-test":"spinner"}))},ae=a(40),ne=(a(254),a(255),function(e){return r.a.createElement("div",{className:"oak-text"},!e.multiline&&r.a.createElement("input",{disabled:e.disabled,autoComplete:"off",className:(e.errorFields&&e.errorFields[e.id]?"error":"")+(e.disabled?" disabled":""),type:e.type?e.type:"text",name:e.id,id:e.id,value:e.data[e.id],onChange:e.handleChange,onFocus:function(){e.handleFocus&&e.handleFocus()}}),e.multiline&&r.a.createElement("textarea",{disabled:e.disabled,className:(e.errorFields&&e.errorFields[e.id]?"error":"")+(e.disabled?" disabled":""),id:e.id,name:e.id,value:e.data[e.id],onChange:e.handleChange}),r.a.createElement("label",{htmlFor:e.id,className:e.data[e.id]?"active":""},e.label))});var re=a(119),ce=a.n(re),oe=a(120),se=a.n(oe);function ie(e,t,a){var n={cipher:"aes",iter:"12000",ks:256,salt:se.a.enc.Base64.stringify(se.a.enc.Utf8.parse(a))};return ce.a.encrypt(e,t,n)}function le(e){return null===e||null!==e.match(/^ *$/)}var ue=function(e){var t=Object(n.useState)({name:"",email:"",password:"",repeatPassword:"",jwtPassword:"",pageNo:1,created:!1}),a=Object(N.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(null),i=Object(N.a)(s,2),l=i[0],u=i[1],d=Object(n.useState)({name:!1,email:!1,password:!1,repeatPassword:!1,jwtPassword:!1}),p=Object(N.a)(d,2),f=p[0],h=p[1];Object(n.useEffect)((function(){e.getProfile()}),[]);var v=function(e){o(Object(m.a)({},c,Object(ae.a)({},e.currentTarget.name,e.currentTarget.value)))},E=function(e){h(Object(m.a)({},f,Object(ae.a)({},e,!0)))},g=function(e){(function(e){var t=new FormData;return t.append("tenantName",e.tenantName),t.append("email",e.email),t.append("jwtPassword",e.jwtPassword),t.append("problem",ie(e.password,e.solution,e.salt)),t.append("solution",e.solution),e.banner&&t.append("banner",e.banner,"banner.jpg"),J(V.API_URL_TENANT_CREATE,t,{"Content-Type":"multipart/form-data"}).then((function(e){return Promise.resolve(e)}))})({tenantName:c.name,email:c.email,password:c.password,jwtPassword:c.jwtPassword,solution:e.solution,salt:e.salt,banner:l}).then((function(e){200===e.status?(x("notification",!0,{type:"success",message:"Tenant has been created. You can proceed now",duration:3e3}),o(Object(m.a)({},c,{pageNo:c.pageNo+1,created:!0}))):x("notification",!0,{message:"We are facing some problem, please try after sometime",duration:3e3})})).catch((function(e){x("notification",!0,{type:"failure",message:"Unknown error. Please try again or at a later time",duration:3e3})}))};return r.a.createElement("div",{className:"tenant boxed"},!c.created&&r.a.createElement("div",{className:"typography-3 space-bottom-4"},"Tenant creation"),c.created&&r.a.createElement("div",{className:"typography-3 space-bottom-4"},"Tenant [",c.name,"] available now"),1===c.pageNo&&r.a.createElement("div",{className:"form"},r.a.createElement(ne,{id:"name",data:c,label:"Tenant Name",handleChange:function(e){return v(e)},errorFields:f}),r.a.createElement(ne,{id:"email",data:c,label:"Administrator Email",handleChange:function(e){return v(e)},errorFields:f}),r.a.createElement(ne,{id:"password",type:"password",data:c,label:"Administrator Password",handleChange:function(e){return v(e)},errorFields:f}),r.a.createElement(ne,{id:"repeatPassword",type:"password",data:c,label:"Repeat Password",handleChange:function(e){return v(e)},errorFields:f}),r.a.createElement(ne,{id:"jwtPassword",type:"password",data:c,label:"JWT Password",handleChange:function(e){return v(e)},errorFields:f}),r.a.createElement("label",{className:"file-upload space-top-1 space-bottom-4"},r.a.createElement("input",{type:"file",accept:"image/png, image/jpeg",onChange:function(e){u(e.target.files[0])},required:!0}),r.a.createElement("i",{className:"material-icons"},"add_photo_alternate"),!l&&"Choose Banner/Cover Image",l&&l.name),r.a.createElement("div",{className:"action"},r.a.createElement(B,{theme:"primary",variant:"appear",action:function(e){e.preventDefault(),x("spinner"),h({name:!1,email:!1,password:!1,repeatPassword:!1,jwtPassword:!1}),(le(c.name)?(E("name"),x("notification",!0,{type:"failure",message:"Tenant name cannot be empty",duration:3e3}),0):/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(c.email)?le(c.password)?(E("password"),x("notification",!0,{type:"failure",message:"Password cannot be empty",duration:3e3}),0):c.password===c.repeatPassword||(E("repeatPassword"),x("notification",!0,{type:"failure",message:"Password and repeat password should be same",duration:3e3}),0):(E("email"),x("notification",!0,{type:"failure",message:"Email ID is invalid",duration:3e3}),0))&&function(e){return K(V.API_URL+e.name+V.API_KEYS,null).then((function(e){return Promise.resolve(e)}))}({name:c.name}).then((function(e){200===e.status&&g(e.data)}))}},"Create Tenant"))),c.created&&r.a.createElement(B,{theme:"primary",variant:"disappear",action:function(){e.history.push("/".concat(c.name,"/home"))}},"Take me to my tenant"))},me=a(121),de=a.n(me),pe=a(195),fe=function(e){return function(t){t({type:"ADD_AUTH",payload:e})}},he=function(e){var t=Object(i.d)((function(e){return e.authorization})),a=Object(i.d)((function(e){return e.profile})),n=Object(i.c)(),c=function(e){switch(x("spaceChange",!0,""),e){case"readAuthentication":return s();case"authenticate":return o();case"isAdmin":return u();default:return!0}},o=function(){return l("space")},s=function(){return l("space",!1)},l=function(){var a=Object(pe.a)(de.a.mark((function a(r){var c,o,s,i,l=arguments;return de.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=!(l.length>1&&void 0!==l[1])||l[1],x("spaceChange",!0,e.match.params.tenant),!t.isAuth){a.next=4;break}return a.abrupt("return",!0);case 4:if(o="mercury_".concat(e.match.params.tenant),s=e.cookies.get(o),i="/account/user/".concat(e.match.params.tenant),!s){a.next=11;break}try{K("".concat(i,"/session/").concat(s),null).then((function(e){console.log("success"),200===e.status&&n(fe({isAuth:!0,token:e.data.token,secret:"",firstName:e.data.first_name,lastName:e.data.last_name,email:e.data.email,type:e.data.type,userId:e.data.user_id,id:e.data.id}))})).catch((function(t){e.cookies.remove(o),c&&404===t.response.status?(x("notification",!0,{type:"failure",message:"Invalid session token",duration:3e3}),m(e.match.params.tenant)):c&&401===t.response.status?(x("notification",!0,{type:"failure",message:"Session expired",duration:3e3}),m(e.match.params.tenant)):c&&401===t.response.status&&(x("notification",!0,{type:"failure",message:"Unhandled exception",duration:3e3}),m(e.match.params.tenant))}))}catch(r){console.log(r)}a.next=16;break;case 11:if(!c){a.next=15;break}m(e.match.params.tenant),a.next=16;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),u=function(){return d(),!1},m=function(e){window.location.href="".concat("https://oneauth.ioak.org","/#/space/").concat(e,"/login?type=signin&appId=").concat("e8debb00e3b16b4b32222639")},d=function(){e.history.push("/".concat(a.tenant,"/unauthorized"))};return r.a.createElement(r.a.Fragment,null,function(){var t;return null===(t=e.middleware)||void 0===t||t.forEach((function(e){if(!c(e))return!1})),!0}()&&r.a.createElement(e.component,Object.assign({},e,{profile:a,space:e.match.params.tenant})))},ve=function(){return r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),"Unauthorized")},Ee=a(64),ge=(a(363),a(58),function(e){var t=Object(i.d)((function(e){return e.authorization}));return r.a.createElement(r.a.Fragment,null,t.isAuth&&r.a.createElement(B,{theme:"primary",variant:"disappear",small:!0},r.a.createElement("i",{className:"material-icons"},"power_settings_new"),"Logout"),!t.isAuth&&r.a.createElement(B,{theme:"primary",variant:"appear",align:"left",small:!0,action:function(){window.location.href="".concat("https://oneauth.ioak.org","/#/space/").concat(e.space,"/login?appId=").concat("e8debb00e3b16b4b32222639")}},r.a.createElement("i",{className:"material-icons"},"person"),"Login"))}),be=a(196),ye=a.n(be),Ne=a(197),we=a.n(Ne),Oe=(a(364),function(){var e=Object(i.d)((function(e){return e.profile}));return r.a.createElement("div",{className:"logo-container"},"theme_light"===(null===e||void 0===e?void 0:e.theme)&&r.a.createElement("img",{className:"logo",src:we.a,alt:"Mercury logo"}),"theme_dark"===(null===e||void 0===e?void 0:e.theme)&&r.a.createElement("img",{className:"logo",src:ye.a,alt:"Mercury logo"}))}),je=function(e){var t,a;return r.a.createElement("div",{className:"people-link ".concat("person"===(null===(t=e.params)||void 0===t?void 0:t.type)&&(null===(a=e.params)||void 0===a?void 0:a.id)===e.user.id?"active":""),onClick:function(){e.history.push("/".concat(e.space,"/dash?type=person&id=").concat(e.user.id))}},e.user.firstName," ",e.user.lastName)},ke=function(e){return r.a.createElement("div",{className:"people-list"},r.a.createElement("div",{className:"typography-4 people-list-title"},"Direct messages"),e.users.map((function(t){return r.a.createElement(je,{user:t,key:t.id,space:e.space,history:e.history,params:e.params})})))},_e=function(e){return r.a.createElement("div",{className:"channel-list"},r.a.createElement("div",{className:"typography-4 channel-list-title"},"Channels"),r.a.createElement("div",{className:""},"No channels yet"))},Ae=(a(365),function(e){var t,a;return r.a.createElement("div",{className:"oak-avatar ".concat(e.variant?e.variant:"")},r.a.createElement("div",{className:"".concat(e.size?e.size:""," avatar-icon typography-6")},"".concat(null===(t=e.firstName)||void 0===t?void 0:t.substring(0,1)).concat(null===(a=e.lastName)||void 0===a?void 0:a.substring(0,1))),e.showName&&r.a.createElement("div",{className:"avatar-name"},e.firstName))}),Se=function(e){var t=Object(i.d)((function(e){return e.authorization}));return r.a.createElement("div",{className:"left-panel"},r.a.createElement("div",{className:"top-header"},r.a.createElement(Oe,null),r.a.createElement("div",{className:"chat-sidebar-switch"},r.a.createElement("i",{className:"material-icons",onClick:function(){return x("expand-chat-sidebar",!1)}},"menu_open"))),r.a.createElement("div",{className:"second-row"},r.a.createElement(Ae,{firstName:t.firstName,lastName:t.lastName}),r.a.createElement(ge,{space:e.space})),r.a.createElement("div",{className:"channel-list-wrapper"},r.a.createElement(_e,{history:e.history,space:e.space,params:e.params})),r.a.createElement("div",{className:"people-list-wrapper"},e.users&&r.a.createElement(ke,{users:e.users,history:e.history,space:e.space,params:e.params})))},Ie=(a(45),a(198)),Te=a(199),Ue=a(207),Ce=a(200),Re=a(208),Pe=a(201),xe=a.n(Pe),Fe=(a(465),a(466),a(467),a(468),function(e){return r.a.createElement("div",{className:"oak-editor-toolbar"},r.a.createElement("div",{id:"toolbar"},r.a.createElement("button",{className:"toolbar-icon ql-bold"}),r.a.createElement("button",{className:"toolbar-icon ql-italic"}),r.a.createElement("button",{className:"toolbar-icon ql-underline"}),r.a.createElement("button",{className:"toolbar-icon ql-strike"}),e.align&&r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"toolbar-icon ql-align",value:"center"}),r.a.createElement("button",{className:"toolbar-icon ql-align",value:"right"}),r.a.createElement("button",{className:"toolbar-icon ql-align",value:"justify"})),r.a.createElement("button",{className:"toolbar-icon ql-list",value:"ordered"}),r.a.createElement("button",{className:"toolbar-icon ql-list",value:"bullet"}),e.indent&&r.a.createElement("button",{className:"toolbar-icon ql-indent",value:"-1"}),e.indent&&r.a.createElement("button",{className:"toolbar-icon ql-indent",value:"+1"}),e.color&&r.a.createElement("select",{className:"toolbar-icon ql-color"},r.a.createElement("option",{value:"red"}),r.a.createElement("option",{value:"green"}),r.a.createElement("option",{value:"blue"}),r.a.createElement("option",{value:"#f0f0f0"}),r.a.createElement("option",{selected:!0})),r.a.createElement("button",{className:"toolbar-icon ql-blockquote"}),e.font&&r.a.createElement("select",{className:"toolbar-icon ql-font"}),e.heading&&r.a.createElement("select",{className:"toolbar-icon ql-header"}),e.size&&r.a.createElement("select",{className:"toolbar-icon ql-size"}),r.a.createElement("button",{className:"toolbar-icon ql-image"})))}),Me=function(e){function t(e){var a;return Object(Ie.a)(this,t),(a=Object(Ue.a)(this,Object(Ce.a)(t).call(this,e))).formats=["header","bold","italic","underline","strike","blockquote","list","bullet","indent","color","font","code-block","link","image","background","align","size"],a.modules={toolbar:{container:"#toolbar"},keyboard:{bindings:{linebreak:{key:13,shiftKey:!1,handler:function(e){}}}}},a.IMAGE_MIME_REGEX=/^image\/(p?jpeg|gif|png)$/i,a.loadImage=function(e){var t=new FileReader;t.onload=function(e){var t;if(null===e||void 0===e?void 0:null===(t=e.target)||void 0===t?void 0:t.result){var a,n,r=document.createElement("img");r.src=e.target.result;var c=null===(a=window)||void 0===a?void 0:null===(n=a.getSelection())||void 0===n?void 0:n.getRangeAt(0);c&&(c.deleteContents(),c.insertNode(r))}},t.readAsDataURL(e)},a.handleEnter=function(e){13!==e.keyCode||e.shiftKey||"<p><br></p>"===a.props.data[a.props.id]||a.props.handleEnter&&a.props.handleEnter()},a.handleChange=function(e,t,n){"api"===n&&a.state.blockApiChangeEvents?a.setState({blockApiChangeEvents:!1}):a.props.handleChange({target:{name:a.props.id,value:e}})},a.handleFocus=function(){a.setState(Object(m.a)({},a.state,{customClass:"active"}))},a.handleBlur=function(){a.setState(Object(m.a)({},a.state,{customClass:""}))},a.state={customClass:"",blockApiChangeEvents:!0},a}return Object(Re.a)(t,e),Object(Te.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.onpaste=function(t){var a,n=null===(a=t.clipboardData)||void 0===a?void 0:a.items;if(n)for(var r=0;r<n.length;r+=1)if(e.IMAGE_MIME_REGEX.test(n[r].type))return t.preventDefault(),void e.loadImage(n[r].getAsFile())}}},{key:"render",value:function(){return r.a.createElement("div",{className:"oak-editor ".concat(this.props.bubble?"bubble":""," ").concat(this.state.customClass," ").concat(this.props.center?"center":"")},r.a.createElement("label",null,this.props.label),!this.props.bottom&&r.a.createElement(Fe,{indent:this.props.indent,font:this.props.font,heading:this.props.heading,size:this.props.size,color:this.props.color,align:this.props.align}),r.a.createElement("div",{className:"quill-wrapper"},r.a.createElement(xe.a,{value:this.props.data[this.props.id],onChange:this.handleChange,theme:this.props.bubble?"bubble":"snow",modules:this.modules,formats:this.formats,onKeyUp:this.handleEnter,onFocus:this.handleFocus,onBlur:this.handleBlur})),this.props.bottom&&r.a.createElement(Fe,{indent:this.props.indent,font:this.props.font,heading:this.props.heading,size:this.props.size,color:this.props.color,align:this.props.align}))}}]),t}(r.a.Component),ze=function(e){var t=Object(n.useState)({message:""}),a=Object(N.a)(t,2),c=a[0],o=a[1],s=function(){var t;e.channel.push("new_message",{receiver:null===(t=e.params)||void 0===t?void 0:t.id,content:c.message},1e4),o({message:""})};return r.a.createElement("div",{className:"compose-section"},e.socket&&r.a.createElement("form",{method:"GET",onSubmit:s,noValidate:!0},r.a.createElement(Me,{data:c,id:"message",handleChange:function(e){o(Object(m.a)({},c,Object(ae.a)({},e.target.name,e.target.value)))},handleEnter:s,bottom:!0,size:!0,color:!0,align:!0})),!e.socket&&r.a.createElement("div",null,"Initializing..."))},Le=a(122),qe=a(123),De=a.n(qe);function He(){var e=Object(Le.a)(["\n  query Personmessages(\n    $selfId: ID!\n    $otherId: ID!\n    $pageSize: Int!\n    $lastIndex: Int!\n  ) {\n    personmessages(\n      selfId: $selfId\n      otherId: $otherId\n      lastIndex: $lastIndex\n      pageSize: $pageSize\n    ) {\n      lastIndex\n      hasMore\n      results {\n        id\n        content\n        sender\n        receiver\n      }\n    }\n  }\n"]);return He=function(){return e},e}function Ge(){var e=Object(Le.a)(["\n  query AllUsers {\n    allUsers {\n      id\n      firstName\n      lastName\n      email\n    }\n  }\n"]);return Ge=function(){return e},e}var Be=De()(Ge()),$e=De()(He()),We=(a(469),function(e){return r.a.createElement("div",{className:"oak-viewer"},r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.children||""}}))}),Ye=a(68),Qe=(new Date).getFullYear(),Ke=function(e,t){var a=e.getYear(),n=e.getMonth(),r=e.getDate(),c=t.getYear(),o=t.getMonth(),s=t.getDate();return a===c&&n===o&&r===s},Je=function(e){var t=Object(n.useState)(!1),a=Object(N.a)(t,2),c=a[0],o=a[1];return Object(n.useEffect)((function(){e.message.sender==e.selfUser.id&&o(!0)}),[e.message]),r.a.createElement("div",{className:"view-message"},r.a.createElement("div",{className:"column-left"},c&&r.a.createElement(Ae,{firstName:e.selfUser.firstName||"",lastName:e.selfUser.lastName||"",variant:"outline"}),!c&&r.a.createElement(Ae,{firstName:e.otherUser.firstName||"",lastName:e.otherUser.lastName||"",variant:"dotted"})),r.a.createElement("div",{className:"column-right"},r.a.createElement("div",{className:"sender-meta"},c&&r.a.createElement("div",{className:"sender-name"},e.selfUser.firstName," ",e.selfUser.lastName),!c&&r.a.createElement("div",{className:"sender-name"},e.otherUser.firstName," ",e.otherUser.lastName),r.a.createElement("div",{className:"sent-time typography-4"},function(e){if(e){var t=new Date(e);return Ke(t,new Date)?"Today at ".concat(Object(Ye.a)(t,"h:mm a")):Object(Ye.a)(t,t.getFullYear()===Qe?"MMM d":"MMM d, yyyy")}return""}(e.message.inserted_at))),r.a.createElement("div",null,r.a.createElement(We,{key:Object(R.a)()},e.message.content))))},Ve=function(e){var t,a=Object(n.useState)([]),c=Object(N.a)(a,2),o=c[0],s=c[1];return Object(n.useEffect)((function(){console.log(e.newMessages),e.newMessages?e.selfUser.id===e.otherUser.id?s(e.newMessages.filter((function(e){return e.sender===e.receiver}))):s(e.newMessages.filter((function(t){return t.sender==e.otherUser.id||t.receiver==e.otherUser.id}))):s([])}),[e.newMessages,e.selfUser,e.otherUser]),r.a.createElement("div",{className:"message-stream"},null===(t=e.messages)||void 0===t?void 0:t.map((function(t,a){return r.a.createElement(Je,{key:t.id||a,message:t,selfUser:e.selfUser,otherUser:e.otherUser})})),null===o||void 0===o?void 0:o.map((function(t,a){return r.a.createElement(Je,{key:t.id||a,message:t,selfUser:e.selfUser,otherUser:e.otherUser})})))},Xe=(a(470),function(e){var t=Object(n.useState)(!1),a=Object(N.a)(t,2),c=a[0],o=a[1];function s(){var t,a,n;((null===(t=document.querySelector(e.selector||".oak-infinite-scroll"))||void 0===t?void 0:t.clientHeight)||0)+((null===(a=document.querySelector(e.selector||".oak-infinite-scroll"))||void 0===a?void 0:a.scrollTop)||0)>=((null===(n=document.querySelector(e.selector||".oak-infinite-scroll"))||void 0===n?void 0:n.scrollHeight)||0)&&o(!0)}function i(){var t,a,n,r;((null===(t=document.querySelector(e.selector||".oak-infinite-scroll"))||void 0===t?void 0:t.scrollHeight)||0)>=((null===(a=document.querySelector(e.selector||".oak-infinite-scroll"))||void 0===a?void 0:a.clientHeight)||0)&&0===((null===(n=document.querySelector(e.selector||".oak-infinite-scroll"))||void 0===n?void 0:n.scrollTop)||0)&&(o(!0),null===(r=document.querySelector(e.selector||".oak-infinite-scroll"))||void 0===r||r.scrollTo(0,10))}return Object(n.useEffect)((function(){var t;return null===(t=document.querySelector(e.selector||".oak-infinite-scroll"))||void 0===t||t.addEventListener("scroll",e.reverseOrder?i:s),function(){var t;return null===(t=document.querySelector(e.selector||".oak-infinite-scroll"))||void 0===t?void 0:t.addEventListener("scroll",e.reverseOrder?i:s)}}),[]),Object(n.useEffect)((function(){c&&(e.handleChange(),o(!1))}),[c]),r.a.createElement("div",{className:e.selector?"oak-infinite-scroll":"oak-infinite-scroll native-scroll"},e.children)}),Ze=function(e){var t,a=Object(Ee.a)($e,{notifyOnNetworkStatusChange:!0,variables:{selfId:"",otherId:"",lastIndex:-1,pageSize:20}}),c=Object(N.a)(a,2),o=c[0],s=c[1],l=s.loading,u=(s.error,s.data),d=s.called,p=s.fetchMore,f=s.refetch,h=Object(i.d)((function(e){return e.authorization})),v=Object(n.useState)([]),E=Object(N.a)(v,2),g=E[0],b=E[1],y=Object(n.useState)(),w=Object(N.a)(y,2),O=w[0],j=w[1],k=Object(n.useState)(),_=Object(N.a)(k,2),A=_[0],S=_[1];Object(n.useEffect)((function(){h.isAuth&&e.users&&(j(e.users.find((function(e){return e.id==h.id}))),S(e.users.find((function(t){return t.id==e.params.id}))),I())}),[h,e.users,e.params]);var I=function(){d?f({selfId:h.id,otherId:e.params.id,lastIndex:-1,pageSize:20}):o({variables:{selfId:h.id,otherId:e.params.id,lastIndex:-1,pageSize:20}})};Object(n.useEffect)((function(){e.channel&&e.channel.on("new_message",(function(e){b((function(t){return[].concat(Object(X.a)(t),[e])})),setTimeout((function(){var e=document.getElementById("message-stream");e&&(e.scrollTop=e.scrollHeight-e.clientHeight)}),0)}))}),[e.channel]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"message-stream-container",id:"message-stream"},O&&A&&r.a.createElement(Xe,{handleChange:function(){console.log("scrolled"),function(){var e;!l&&(null===u||void 0===u?void 0:u.personmessages)&&(null===u||void 0===u?void 0:null===(e=u.personmessages)||void 0===e?void 0:e.hasMore)&&p({variables:{lastIndex:u.personmessages.lastIndex},updateQuery:function(e,t){var a=t.fetchMoreResult;return{personmessages:Object(m.a)({},e.personmessages,{results:[].concat(Object(X.a)(a.personmessages.results),Object(X.a)(e.personmessages.results)),lastIndex:a.personmessages.lastIndex,hasMore:a.personmessages.hasMore})}}})}()},selector:".message-stream-container",reverseOrder:!0},r.a.createElement(Ve,{params:e.params,messages:null===u||void 0===u?void 0:null===(t=u.personmessages)||void 0===t?void 0:t.results,newMessages:g,selfUser:O,otherUser:A}))),l&&r.a.createElement(Z,null))},et=function(e){return r.a.createElement("div",{className:"main-section-header"},r.a.createElement("i",{className:"material-icons chat-sidebar-switch",onClick:function(){return x("expand-chat-sidebar")}},"menu"),r.a.createElement("i",{className:"material-icons"},"person"),e.user.firstName," ",e.user.lastName)},tt=function(e){var t=Object(n.useState)(),a=Object(N.a)(t,2),c=a[0],o=a[1];return Object(n.useEffect)((function(){var t,a,n,r;(null===(t=e.params)||void 0===t?void 0:t.id)&&"person"===(null===(a=e.params)||void 0===a?void 0:a.type)?o(e.users.find((function(t){return t.id===e.params.id}))):(null===(n=e.params)||void 0===n?void 0:n.id)&&"channel"===(null===(r=e.params)||void 0===r?void 0:r.type)&&(console.log("channel"),o(void 0))}),[e.params]),r.a.createElement("div",{className:"main-section"},r.a.createElement("div",{className:"header-wrapper"},c&&r.a.createElement(et,{user:c})),r.a.createElement("div",{className:"message-stream-wrapper"},r.a.createElement(Ze,{channel:e.channel,params:e.params,users:e.users})),r.a.createElement("div",{className:"compose-wrapper"},r.a.createElement(ze,{socket:e.socket,channel:e.channel,params:e.params})))},at=a(125),nt=function(e){var t=Object(n.useState)(!0),a=Object(N.a)(t,2),c=a[0],o=a[1];Object(n.useEffect)((function(){F().subscribe((function(e){"expand-chat-sidebar"===e.name&&o(e.signal)}))}),[]);var s=Object(i.d)((function(e){return e.authorization})),l=Object(Ee.a)(Be),u=Object(N.a)(l,2),m=u[0],d=u[1],p=d.loading,f=d.error,h=d.data,v=d.called,E=Object(n.useState)({type:"",id:""}),g=Object(N.a)(E,2),b=g[0],y=g[1];return Object(n.useEffect)((function(){s.isAuth&&!v&&m()}),[s]),Object(n.useEffect)((function(){y(at.parse(e.location.search))}),[e.location.search]),r.a.createElement("div",{className:"dash"},r.a.createElement("div",{className:"left-panel-wrapper ".concat(c?"show":"hide")},r.a.createElement(Se,{space:e.space,history:e.history,params:b,users:null===h||void 0===h?void 0:h.allUsers})),r.a.createElement("div",{className:"main-section-wrapper"},!p&&!f&&h&&r.a.createElement(tt,{socket:e.socket,channel:e.channel,params:b,users:h.allUsers})))},rt={themecolor1:ct("#69A7BF"),themecolor2:ct("#99587B"),themecolor3:ct("#A66C26"),themecolor4:ct("#37AE82")};function ct(e){return Object(T.a)({palette:{primary:{main:e},secondary:{main:e}}})}var ot=Object(i.b)((function(e){return{user:e.user,profile:e.profile}}),{getProfile:function(){return function(e){e({type:"GET_PROFILE"})}},setProfile:function(e){return function(t){t({type:"SET_PROFILE",payload:e})}},getUser:function(){return function(e){e({type:"GET_USER"})}},addUser:function(e){return function(t){t({type:"ADD_USER",payload:e})}}})(Object(s.b)((function(e){var t=Object(i.d)((function(e){return e.authorization})),a=Object(n.useState)(),c=Object(N.a)(a,2),o=c[0],s=c[1],l=Object(n.useState)(),u=Object(N.a)(l,2),d=u[0],p=u[1],f=Object(n.useState)(!1),h=Object(N.a)(f,2),v=(h[0],h[1]),E=Object(n.useState)(""),g=Object(N.a)(E,2),b=g[0],y=g[1],T=Object(j.a)({uri:"https://mercury-ws.herokuapp.com/graphiql"}),C=Object(k.a)((function(e,a){var n=a.headers;return{headers:Object(m.a)({},n,{authorization:"".concat(b," ").concat(null===t||void 0===t?void 0:t.token)||""})}})),R=new O.c({link:C.concat(T),cache:new w.a});return Object(n.useEffect)((function(){e.getProfile(),F().subscribe((function(e){"show-navbar-element"===e.name?v(e.signal):"spaceChange"===e.name&&y(e.data)}))}),[]),Object(n.useEffect)((function(){t.isAuth&&!o&&b&&s(new A.Socket("".concat("wss://mercury-ws.herokuapp.com","/socket/websocket?auth_token=").concat(t.token),{params:{auth_token:t.token,space:b}}))}),[t,b]),Object(n.useEffect)((function(){if(o){o.connect(),o.onError((function(){return console.log("there was an error with the connection!")})),o.onClose((function(){return console.log("the connection dropped")}));var e=o.channel("user:".concat(t.id));e.join().receive("ok",(function(e){var t=e.messages;return console.log("catching up",t)})).receive("error",(function(e){var t=e.reason;return console.log("failed join",t)})).receive("timeout",(function(){return console.log("Networking issue. Still waiting...")})),p(e)}}),[o]),r.a.createElement(_.a,{client:R},r.a.createElement("div",{className:"App ".concat(e.profile.theme," ").concat(e.profile.textSize," ").concat(e.profile.themeColor)},r.a.createElement(I.HashRouter,null,r.a.createElement("div",{className:"body"},r.a.createElement("div",{className:"body-content"},r.a.createElement(te,null),r.a.createElement(U.a,{theme:rt.themecolor1},r.a.createElement(S.Route,{path:"/login",render:function(t){return r.a.createElement(he,Object.assign({},t,e,{component:L}))}}),r.a.createElement(S.Route,{path:"/:tenant/unauthorized",render:function(t){return r.a.createElement(he,Object.assign({},t,e,{component:ve,middleware:["isAuthenticated"]}))}}),r.a.createElement(S.Route,{path:"/",exact:!0,render:function(t){return r.a.createElement(he,Object.assign({},t,e,{component:$}))}}),r.a.createElement(S.Route,{path:"/home",exact:!0,render:function(t){return r.a.createElement(he,Object.assign({},t,e,{component:$}))}}),r.a.createElement(S.Route,{path:"/tenant",exact:!0,render:function(t){return r.a.createElement(he,Object.assign({},t,e,{component:ue}))}}),r.a.createElement(S.Route,{path:"/:tenant/home",render:function(t){return r.a.createElement(he,Object.assign({},t,e,{component:M,middleware:["readAuthentication"]}))}}),r.a.createElement(S.Route,{path:"/:tenant/dash",render:function(t){return r.a.createElement(he,Object.assign({},t,e,{component:nt,middleware:["readAuthentication"],socket:o,channel:d}))}}),r.a.createElement(S.Route,{path:"/:tenant",exact:!0,render:function(t){return r.a.createElement(he,Object.assign({},t,e,{component:M,middleware:["readAuthentication"]}))}})))))))}))),st=function(e){return r.a.createElement(i.a,{store:y},r.a.createElement(ot,e))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(s.a,null,r.a.createElement(st,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},58:function(e,t,a){}},[[209,1,2]]]);
//# sourceMappingURL=main.60d1bdae.chunk.js.map